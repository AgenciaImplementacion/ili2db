language: java
services:
  - postgres
build:
  ci:
    - ant -f build-ili2pg.xml jar
    - ant -f build-ili2gpkg.xml jar
    - psql -c 'create role shippable with superuser;' -U postgres
    - psql -c 'create database ili2db;' -U postgres
    - lsb_release -a
    - sudo apt-get update
    - apt-cache search "postgis"
    - sudo apt-get install postgresql-9.4-postgis-2.1
    - psql -U postgres -c 'create extension postgis;'
    - psql -U postgres -c 'create extension "uuid-ossp";'
    - mkdir -p shippable/testresults
    - ant -f build-ili2pg.xml tests -Dreport.dir=shippable/testresults -Ddburl=jdbc:postgresql:ili2db -Ddbusr=postgres
    - tar -cvzf testReports.tar.gz shippable/testresults/*
    - mail  -a testReports.tar.gz -s testresults ce@eisenhutinformatik.ch < /dev/null
integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - ce@eisenhutinformatik.ch
      on_success: always
      on_failure: always
    